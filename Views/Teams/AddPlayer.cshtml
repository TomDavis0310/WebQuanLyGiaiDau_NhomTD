@model WebQuanLyGiaiDau_NhomTD.Models.Player

@{
    ViewData["Title"] = "Th√™m C·∫ßu Th·ªß";
}

<h1 class="text-center text-primary mt-4">‚öΩ Th√™m C·∫ßu Th·ªß M·ªõi</h1>
<h4 class="text-center text-secondary mb-4">ƒê·ªôi: @ViewData["TeamName"]</h4>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <form asp-action="AddPlayer" method="post" enctype="multipart/form-data" class="bg-light p-4 rounded shadow">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
            <input type="hidden" asp-for="TeamId" value="@ViewData["TeamId"]" />

            <div class="mb-3">
                <label asp-for="FullName" class="form-label fw-semibold">H·ªç T√™n</label>
                <input asp-for="FullName" class="form-control" placeholder="Nh·∫≠p h·ªç t√™n c·∫ßu th·ªß..." />
                <span asp-validation-for="FullName" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Position" class="form-label fw-semibold">V·ªã Tr√≠</label>
                <input asp-for="Position" class="form-control" placeholder="V·ªã tr√≠ thi ƒë·∫•u..." />
                <span asp-validation-for="Position" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Number" class="form-label fw-semibold">S·ªë √Åo</label>
                <input asp-for="Number" class="form-control" placeholder="S·ªë √°o..." min="0" max="99" type="number" />
                <span asp-validation-for="Number" class="text-danger"></span>
                <small class="text-muted">S·ªë √°o ph·∫£i t·ª´ 0 ƒë·∫øn 99</small>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">·∫¢nh C·∫ßu Th·ªß</label>
                <input asp-for="ImageUrl" type="file" name="imageUrl" class="form-control" accept="image/*" />
                <small class="text-muted">Ch·ªçn ·∫£nh ƒë·∫°i di·ªán cho c·∫ßu th·ªß (kh√¥ng b·∫Øt bu·ªôc)</small>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-success">
                    üíæ L∆∞u C·∫ßu Th·ªß
                </button>
                <a asp-action="Details" asp-route-id="@ViewData["TeamId"]" class="btn btn-outline-secondary">
                    ‚Ü©Ô∏è Quay L·∫°i
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        // X√°c nh·∫≠n tr∆∞·ªõc khi submit form
        $(document).ready(function () {
            $('form').submit(function (e) {
                // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
                var fullName = $('#FullName').val();
                var position = $('#Position').val();
                var number = $('#Number').val();

                if (!fullName || !position || !number) {
                    // N·∫øu thi·∫øu th√¥ng tin, hi·ªÉn th·ªã th√¥ng b√°o v√† ngƒÉn submit
                    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin c·∫ßu th·ªß (H·ªç t√™n, V·ªã tr√≠, S·ªë √°o)');
                    e.preventDefault();
                    return false;
                }

                // Ki·ªÉm tra s·ªë √°o h·ª£p l·ªá
                if (number < 0 || number > 99) {
                    alert('S·ªë √°o ph·∫£i t·ª´ 0 ƒë·∫øn 99');
                    e.preventDefault();
                    return false;
                }

                // Ki·ªÉm tra k√≠ch th∆∞·ªõc file ·∫£nh n·∫øu c√≥
                var fileInput = $('input[name="imageUrl"]')[0];
                if (fileInput && fileInput.files.length > 0) {
                    var fileSize = fileInput.files[0].size; // k√≠ch th∆∞·ªõc t√≠nh b·∫±ng byte
                    var maxSize = 5 * 1024 * 1024; // 5MB

                    if (fileSize > maxSize) {
                        alert('K√≠ch th∆∞·ªõc ·∫£nh qu√° l·ªõn. Vui l√≤ng ch·ªçn ·∫£nh nh·ªè h∆°n 5MB.');
                        e.preventDefault();
                        return false;
                    }
                }

                return true;
            });

            // Hi·ªÉn th·ªã xem tr∆∞·ªõc ·∫£nh khi ch·ªçn file
            $('input[name="imageUrl"]').change(function() {
                if (this.files && this.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        // T·∫°o ho·∫∑c c·∫≠p nh·∫≠t ph·∫ßn t·ª≠ xem tr∆∞·ªõc
                        var previewContainer = $('.image-preview');
                        if (previewContainer.length === 0) {
                            // T·∫°o m·ªõi n·∫øu ch∆∞a c√≥
                            var newPreview = '<div class="image-preview mt-2 mb-2"><p>·∫¢nh ƒë√£ ch·ªçn:</p><img src="' + e.target.result + '" class="img-thumbnail" style="max-height: 150px;" /></div>';
                            $('input[name="imageUrl"]').after(newPreview);
                        } else {
                            // C·∫≠p nh·∫≠t n·∫øu ƒë√£ c√≥
                            previewContainer.find('img').attr('src', e.target.result);
                        }
                    }

                    reader.readAsDataURL(this.files[0]);
                }
            });
        });
    </script>
}
