@page
@model PersonalDataModel
@{
    ViewData["Title"] = "Dữ Liệu Cá Nhân";
    ViewData["ActivePage"] = ManageNavPages.PersonalData;
}

<link rel="stylesheet" href="~/css/manage-layout.css" asp-append-version="true" />

<div class="profile-info-card fade-in">
    <!-- GDPR Info Section -->
    <div class="section-card mb-4">
        <div class="section-header">
            <i class="bi bi-shield-lock"></i>
            <h4>Quyền Riêng Tư & Dữ Liệu</h4>
        </div>

        <div class="alert alert-info-custom">
            <i class="bi bi-info-circle-fill"></i>
            <div>
                <strong>Quyền của bạn:</strong>
                <ul class="mb-0 mt-2">
                    <li>Tải xuống tất cả dữ liệu cá nhân mà chúng tôi lưu trữ</li>
                    <li>Xóa vĩnh viễn tài khoản và toàn bộ dữ liệu của bạn</li>
                    <li>Dữ liệu sẽ được cung cấp ở định dạng JSON</li>
                </ul>
            </div>
        </div>

        <div class="info-grid mt-4">
            <div class="info-item">
                <div class="info-item-label">
                    <i class="bi bi-database"></i>
                    <span>Dữ liệu được lưu trữ</span>
                </div>
                <div class="info-item-value">
                    Thông tin cá nhân, lịch sử hoạt động, cài đặt
                </div>
            </div>

            <div class="info-item">
                <div class="info-item-label">
                    <i class="bi bi-shield-check"></i>
                    <span>Bảo mật</span>
                </div>
                <div class="info-item-value">
                    Mã hóa và bảo vệ theo chuẩn quốc tế
                </div>
            </div>
        </div>
    </div>

    <!-- Download Data Section -->
    <div class="section-card mb-4">
        <div class="section-header">
            <i class="bi bi-download"></i>
            <h4>Tải Xuống Dữ Liệu</h4>
        </div>

        <p class="text-muted">
            Tải xuống bản sao của tất cả dữ liệu cá nhân mà chúng tôi lưu trữ về bạn. 
            Dữ liệu sẽ được cung cấp dưới dạng file JSON.
        </p>

        <form id="download-data" asp-page="DownloadPersonalData" method="post">
            <button class="btn-primary-gradient" type="submit">
                <i class="bi bi-download"></i>
                <span>Tải xuống dữ liệu của tôi</span>
            </button>
        </form>
    </div>

    <!-- Delete Account Section -->
    <div class="section-card">
        <div class="section-header">
            <i class="bi bi-trash" style="color: var(--danger-color);"></i>
            <h4 style="color: var(--danger-color);">Xóa Tài Khoản</h4>
        </div>

        <div class="alert alert-danger-custom">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <div>
                <strong>Cảnh báo nghiêm trọng!</strong>
                <p class="mb-2 mt-2">
                    Xóa tài khoản của bạn sẽ:
                </p>
                <ul class="mb-0">
                    <li><strong>Xóa vĩnh viễn</strong> tất cả dữ liệu cá nhân</li>
                    <li><strong>Không thể khôi phục</strong> sau khi đã xóa</li>
                    <li><strong>Hủy bỏ</strong> tất cả dịch vụ và đăng ký liên quan</li>
                    <li><strong>Mất quyền truy cập</strong> vào tất cả nội dung của bạn</li>
                </ul>
                <p class="mb-0 mt-2">
                    Hành động này <strong>KHÔNG THỂ HOÀN TÁC</strong>. Vui lòng cân nhắc kỹ trước khi thực hiện.
                </p>
            </div>
        </div>

        <div class="text-center mt-4">
            <a id="delete" 
               asp-page="DeletePersonalData" 
               class="btn btn-lg"
               style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 0.875rem 2rem; border-radius: var(--radius-md, 12px); font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;">
                <i class="bi bi-trash-fill"></i>
                <span>Xóa tài khoản vĩnh viễn</span>
            </a>
        </div>
    </div>

    <!-- Support Info -->
    <div class="alert alert-info-custom mt-4">
        <i class="bi bi-question-circle-fill"></i>
        <div>
            <strong>Cần hỗ trợ?</strong> 
            Nếu bạn có câu hỏi về dữ liệu cá nhân hoặc quyền riêng tư, 
            vui lòng liên hệ với bộ phận hỗ trợ của chúng tôi.
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function() {
            // Add loading state to download button
            $('#download-data').on('submit', function() {
                const $btn = $(this).find('button');
                $btn.addClass('btn-loading');
                $btn.find('span').text('Đang chuẩn bị...');
                
                setTimeout(function() {
                    $btn.removeClass('btn-loading');
                    $btn.find('span').text('Tải xuống dữ liệu của tôi');
                }, 3000);
            });

            // Enhanced delete confirmation
            $('#delete').on('click', function(e) {
                e.preventDefault();
                const href = $(this).attr('href');
                
                if (confirm('CẢNH BÁO: Bạn có HOÀN TOÀN CHẮC CHẮN muốn xóa tài khoản?\n\nHành động này sẽ:\n- Xóa vĩnh viễn tất cả dữ liệu\n- KHÔNG THỂ HOÀN TÁC\n- Hủy tất cả dịch vụ liên quan\n\nNhấn OK để tiếp tục.')) {
                    if (confirm('Xác nhận lần cuối: Bạn có chắc chắn 100%?')) {
                        window.location.href = href;
                    }
                }
            });
        });
    </script>
}
